var page=require("webpage").create(),fs=require("fs"),sys=require("system");page.onConsoleMessage=function(e){console.log(e)},console.log("\n************* CORS PLANNER **************"),console.log("*** Crawl CORS Module Code and Titles ***"),console.log("*****************************************\n");var url="https://sit.aces01.nus.edu.sg/cors/jsp/report/ModuleInfoListing.jsp",output="list.js",update=!0,global="../info.js";if(sys.args.length>1)for(var i=1;i<sys.args.length;i++)sys.args[i]==="-o"?output=sys.args[i+1]+".js":sys.args[i]==="-n"&&(update=!1);var timeStart=new Date;page.open(encodeURI(url),function(e){function i(e,t){console.log("===> Output to file ["+e+"]"),fs.write(e,"define(function(){return "+JSON.stringify(t)+"});","w"),console.log("===> Output Completed")}function s(e){console.log("===> Update global Info ["+e+"]");var t=fs.open(e,"rw"),n=t.read();n=n.replace(/lastUpdate\s*:\s*(\".*\")/,'lastUpdate: "'+new Date+'"'),t.write(n),t.flush(),t.close(),console.log("===> Update Completed")}if(e!=="success")console.log("===! Unable to access network\n");else{console.log("===> Page Loaded");var t=new Date,n=page.evaluate(function(){var e,t,n,r,i,s=[];n=document.getElementsByClassName("tableframe")[0],r=n.getElementsByTagName("tr");for(e=1,t=r.length;e<t;e++)i=r[e].getElementsByTagName("td"),s.push(i[1].textContent.trim()+" "+i[2].textContent.trim());return console.log("===> Found "+s.length+" Modules"),s});i(output,n),update&&s(global);var r=new Date-timeStart;console.log("Spent "+(r/1e3).toFixed(2)+"s")}phantom.exit()});